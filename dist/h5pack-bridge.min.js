!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((e="undefined"!=typeof globalThis?globalThis:e||self).H5PackBridge={})}(this,function(e){"use strict";class a{h5packBridge;moduleName;constructor(e,a){this.h5packBridge=e,this.moduleName=a}async call(e,a){return this.h5packBridge.callNative(this.moduleName,e,a)}handleError(e,a="Operation failed"){throw console.error(`[${this.moduleName}] Error:`,e),new Error(e.message||a)}}class t extends a{constructor(e){super(e,"camera")}async open(e){try{return await this.call("open",{cameraType:e.cameraType||"back"})}catch(e){return this.handleError(e,"Failed to open camera")}}async chooseImage(e={}){try{return await this.call("chooseImage",e)}catch(e){return this.handleError(e,"Failed to open camera")}}async checkPermission(){try{return await this.call("checkPermission")}catch(e){return this.handleError(e,"Failed to check camera permission")}}async requestPermission(){try{return await this.call("requestPermission")}catch(e){return this.handleError(e,"Failed to request camera permission")}}}const s=new class{callbacks=new Map;modules=new Map;isAvailable=!1;constructor(){return"undefined"!=typeof window&&window.ReactNativeWebView&&(this.isAvailable=!0),this.setupEventListeners(),new Proxy(this,{get:(e,a)=>e.modules.has(a)?e.modules.get(a):e[a]})}registerModule(e,a){this.modules.set(e,a)}callNative(e,a,t){return new Promise((s,r)=>{if(!this.isAvailable)return void r(new Error("Native bridge not available"));const i=`call_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=setTimeout(()=>{this.cleanupCallback(i),r(new Error("Bridge call timeout"))},3e4);this.callbacks.set(i,{resolve:s,reject:r,timeoutId:o});const n={type:"bridge_call",callId:i,module:e,action:a,params:t,timestamp:Date.now()};window.ReactNativeWebView.postMessage(JSON.stringify(n))})}setupEventListeners(){window.ReactNativeWebView&&document.addEventListener("message",this.handleNativeMessage),window.addEventListener("message",this.handleNativeMessage)}handleNativeMessage=e=>{try{const a=JSON.parse(e.data);if("bridge_response"===a.type){const{callId:e,success:t,data:s,error:r}=a,i=this.callbacks.get(e);i&&(this.cleanupCallback(e),t?i.resolve(s):i.reject(new Error(r||"Native call failed")))}}catch(e){console.error("Failed to handle native message:",e)}};cleanupCallback(e){const a=this.callbacks.get(e);a&&(clearTimeout(a.timeoutId),this.callbacks.delete(e))}};s.registerModule("camera",new t(s)),"undefined"!=typeof window&&(window.h5packBridge=s),e.CameraModule=t,e.default=s,e.h5packBridge=s,Object.defineProperty(e,"__esModule",{value:!0})});
