class e{h5packBridge;moduleName;constructor(e,t){this.h5packBridge=e,this.moduleName=t}async call(e,t){return this.h5packBridge.callNative(this.moduleName,e,t)}handleError(e,t="Operation failed"){throw console.error(`[${this.moduleName}] Error:`,e),new Error(e.message||t)}}class t extends e{constructor(e){super(e,"camera")}async open(e){const t={cameraType:e.cameraType||"back",mediaType:"photo",saveToPhotos:!1,...e};try{return await this.call("open",t)}catch(e){return this.handleError(e,"Failed to open camera")}}async chooseImage(e={}){const t={mediaType:"photo",includeBase64:e?.includeBase64||!1,maxWidth:e?.maxWidth||1024,maxHeight:e?.maxHeight||1024,quality:e?.quality||.8,selectionLimit:e?.selectionLimit||9,...e};try{return await this.call("chooseImage",t)}catch(e){return this.handleError(e,"Failed to open camera")}}async checkPermission(){try{return await this.call("checkPermission")}catch(e){return this.handleError(e,"Failed to check camera permission")}}async requestPermission(){try{return await this.call("requestPermission")}catch(e){return this.handleError(e,"Failed to request camera permission")}}}const a=new class{callbacks=new Map;modules={};isAvailable=!1;constructor(){"undefined"!=typeof window&&window.ReactNativeWebView&&(this.isAvailable=!0),this.setupEventListeners()}get camera(){return this.modules.camera}get location(){return this.modules.location}registerModule(e,t){this.modules[e]=t}getModule(e){return this.modules?.[e]}callNative(e,t,a){return new Promise((r,s)=>{if(!this.isAvailable)return void s(new Error("Native bridge not available"));const i=`call_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=setTimeout(()=>{this.cleanupCallback(i),s(new Error("Bridge call timeout"))},3e4);this.callbacks.set(i,{resolve:r,reject:s,timeoutId:o});const c={type:"bridge_call",callId:i,module:e,action:t,params:a,timestamp:Date.now()};window.ReactNativeWebView.postMessage(JSON.stringify(c))})}setupEventListeners(){window.ReactNativeWebView&&document.addEventListener("message",this.handleNativeMessage),window.addEventListener("message",this.handleNativeMessage)}handleNativeMessage=e=>{try{const t=JSON.parse(e.data);if("bridge_response"===t.type){const{callId:e,success:a,data:r,error:s}=t,i=this.callbacks.get(e);i&&(this.cleanupCallback(e),a?i.resolve(r):i.reject(new Error(s||"Native call failed")))}}catch(e){console.error("Failed to handle native message:",e)}};cleanupCallback(e){const t=this.callbacks.get(e);t&&(clearTimeout(t.timeoutId),this.callbacks.delete(e))}};a.registerModule("camera",new t(a)),a.registerModule("location",new class extends e{constructor(e){super(e,"location")}async getCurrentPosition(e={}){const t={enableHighAccuracy:!1,maximumAge:0,...e};try{return await this.call("getCurrentPosition",t)}catch(e){return this.handleError(e,"Failed to get current location")}}}(a)),"undefined"!=typeof window&&(window.h5packBridge=a);export{t as CameraModule,a as default,a as h5packBridge};
