class e{h5packBridge;moduleName;constructor(e,a){this.h5packBridge=e,this.moduleName=a}async call(e,a){return this.h5packBridge.callNative(this.moduleName,e,a)}handleError(e,a="Operation failed"){throw console.error(`[${this.moduleName}] Error:`,e),new Error(e.message||a)}}class a extends e{constructor(e){super(e,"camera")}async open(e){try{return await this.call("open",{cameraType:e.cameraType||"back"})}catch(e){return this.handleError(e,"Failed to open camera")}}async chooseImage(e={}){try{return await this.call("chooseImage",e)}catch(e){return this.handleError(e,"Failed to open camera")}}async checkPermission(){try{return await this.call("checkPermission")}catch(e){return this.handleError(e,"Failed to check camera permission")}}async requestPermission(){try{return await this.call("requestPermission")}catch(e){return this.handleError(e,"Failed to request camera permission")}}}const t=new class{callbacks=new Map;modules=new Map;isAvailable=!1;constructor(){return"undefined"!=typeof window&&window.ReactNativeWebView&&(this.isAvailable=!0),this.setupEventListeners(),new Proxy(this,{get:(e,a)=>e.modules.has(a)?e.modules.get(a):e[a]})}registerModule(e,a){this.modules.set(e,a)}callNative(e,a,t){return new Promise((r,s)=>{if(!this.isAvailable)return void s(new Error("Native bridge not available"));const i=`call_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c=setTimeout(()=>{this.cleanupCallback(i),s(new Error("Bridge call timeout"))},3e4);this.callbacks.set(i,{resolve:r,reject:s,timeoutId:c});const n={type:"bridge_call",callId:i,module:e,action:a,params:t,timestamp:Date.now()};window.ReactNativeWebView.postMessage(JSON.stringify(n))})}setupEventListeners(){window.ReactNativeWebView&&document.addEventListener("message",this.handleNativeMessage),window.addEventListener("message",this.handleNativeMessage)}handleNativeMessage=e=>{try{const a=JSON.parse(e.data);if("bridge_response"===a.type){const{callId:e,success:t,data:r,error:s}=a,i=this.callbacks.get(e);i&&(this.cleanupCallback(e),t?i.resolve(r):i.reject(new Error(s||"Native call failed")))}}catch(e){console.error("Failed to handle native message:",e)}};cleanupCallback(e){const a=this.callbacks.get(e);a&&(clearTimeout(a.timeoutId),this.callbacks.delete(e))}};t.registerModule("camera",new a(t)),"undefined"!=typeof window&&(window.h5packBridge=t);export{a as CameraModule,t as default,t as h5packBridge};
